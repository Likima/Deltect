\documentclass[12pt, letterpaper]{article}

\usepackage[margin=1in]{geometry}
\setlength{\parindent}{0pt} % default no indents for technical reports
\setlength{\parskip}{10pt}  % for even spacing all around

% list spacing
\usepackage{enumitem}
\setlist[itemize]{
    nosep,
    before=\vspace{-12pt},
}


\usepackage{graphicx}

\begin{document}
\raggedbottom
\raggedright
    \begin{center}
    \textbf{\Large Deltect: Genomic Deletion Pathogenicity Classifier} \\[0.5em]
    \textit{CMPT 310: Introduction to Artificial Intelligence} \\[0.5em]
    Brandon Tang, Tanvir Samra, Kaira Martinez, Jenny Wei \\
    Fall 2025
\end{center}

    \section{AI System}

        \subsection{Introduction}
The goal of our project is to develop a machine learning system, \textbf{Deltect}, that predicts the pathogenicity of genomic deletions. Genomic deletions are structural variants where a segment of DNA is missing. Depending on their location and size, deletions range from benign polymorphisms to pathogenic variants associated with genetic diseases like cancer predisposition syndromes (e.g., BRCA1/2 deletions) and hereditary disorders.

In clinical genetics, manually classifying deletion pathogenicity is time-consuming and requires expert knowledge. While databases like ClinVar provide curated pathogenicity labels, the vast majority of deletions found in patient sequencing data (BAM/CRAM files) remain unclassified. Deltect addresses this gap by training on clinically annotated deletions to predict pathogenicity for novel variants extracted from patient genomes.


        \subsection{Methodology}
            Our methodology involves supervised learning trained on ClinVar deletion variants and HG002/1000 
            Genomes to predict the pathogenicity. We use Sci-kit learn's Random Forest Classifier, with Gradient
            Boosting and optional XGBoost

\subsection{AI Methods}

\textbf{Ensemble Classification:} Random Forest (200 trees) + Gradient Boosting (200 estimators) + XGBoost (optional). Soft voting aggregates probability predictions. Balanced class weights address imbalanced training data.

\textbf{Features:} 18 biological attributes: genomic location (chromosome, position, deletion size), sequence composition (GC content, complexity, repeats), gene context (known disease genes, gene presence).

\subsection{Data Acquisition}

\textbf{ClinVar (NCBI):} 11,218 deletion variants on chr17 via Entrez API (9,559 pathogenic, 1,659 benign/likely benign). Chromosome 17 contains high-value genes (BRCA1, BRCA2, TP53).

\textbf{Reference Genome Sampling (hs37d5):} 7,852 benign regions sampled from reference genome to balance dataset. Matches deletion length distribution (1bp--15Mb). Final ratio: 1.01:1 (pathogenic:benign).

\textbf{Supporting Resources:}
\begin{itemize}
    \item hs37d5 reference genome (GRCh37, 3GB FASTA)
    \item GENCODE v19 GTF (gene annotations, 1GB)
    \item NIST GIAB HG002 benchmark VCF (validation, 200MB)
\end{itemize}

            \textbf{Mitigating Class Imbalance}

            To address this issue of a lower recall performance, we balanced the training set of 10,000 deletions with:
            \begin{itemize}
                \item 5,000 pathogenic deletions (from ClinVar)
                \item 5,000 benign or uncertain deletions (from HG002)
            \end{itemize}
            This balance ensures that the model avoids majority class bias, and improves sensitivity to pathogenic variants.

\textbf{Rationale for Balancing:} ClinVar alone is 85\% pathogenic, causing over-prediction. Reference sampling adds benign variants, improving specificity from 62\% to 88.6\% while maintaining 96\% recall.
            
\subsection{Feature Engineering}

\textbf{Genomic (7):} chr, deletion\_length, log\_deletion\_length, normalized\_chr\_position, 
\\
is\_small/medium/large\_del

\textbf{Sequence (6):} gc\_content, at\_content, cpg\_islands, repeat\_content, homopolymer\_run, complexity\_score (Shannon entropy)

\textbf{Gene Context (5):} has\_gene, is\_known\_disease\_gene (30 curated genes), gene\_length, is\_ensembl\_id, gene\_encoded


\textbf{Architecture:}
\begin{itemize}
    \item Random Forest: 200 trees, max\_depth=15, balanced class weights
    \item Gradient Boosting: 200 estimators, learning\_rate=0.05
    \item XGBoost: scale\_pos\_weight auto-tuned (0.99)
\end{itemize}

\textbf{Performance (10-fold CV):} Precision 89.54\%, Recall 96.89\%, Specificity 88.62\%, AUC-ROC 97.44\%

\textbf{Test Set:} Precision 89.42\%, Recall 96.02\%, Specificity 88.60\%, AUC-ROC 97.54\% (TP=1,835, TN=1,686, FP=217, FN=76)
           


\subsection{AI Pipeline}

\textbf{Training:} Fetch ClinVar variants $\rightarrow$ Preprocess coordinates $\rightarrow$ Extract sequences $\rightarrow$ Sample reference genome $\rightarrow$ Engineer 18 features $\rightarrow$ Train ensemble (10-fold CV) $\rightarrow$ Save model

\textbf{Inference:} Parse BAM CIGAR strings $\rightarrow$ Extract deletions $\rightarrow$ Annotate genes (GTF) $\rightarrow$ Extract sequences $\rightarrow$ Predict probabilities $\rightarrow$ Output ranked JSON (threshold$\ge$0.6)

\subsection{Limitations \& Mitigations}

\textbf{1. Single-chromosome training (chr17):} May not generalize to all chromosomes. \textit{Mitigation:} Chr17 contains diverse gene types; future work to expand to all autosomes.

\textbf{2. Gene annotation dependency:} Accuracy drops 5--10\% without gene context. \textit{Mitigation:} Require GTF input and warn when missing.

\textbf{3. Assembly conflicts:} ClinVar uses GRCh37/38; BAM files may differ. \textit{Mitigation:} Document hs37d5 requirement.

\textbf{4. Specificity gap:} 88.6\% vs recall 96.0\%. \textit{Mitigation:} Adjustable threshold (default=0.6); clinically prioritizes pathogenic detection.

\textbf{5. Sequence extraction:} Training has sequences; BAM variants need fetching. \textit{Mitigation:} Inference pipeline auto-extracts via pysam.

    \section{Features Table (1-2 pages)}
\begin{tabular}{|p{2.8cm}|p{1cm}|p{1.5cm}|p{2cm}|p{1.8cm}|p{5cm}|}
\hline
\textbf{Description} & \textbf{Plat} & \textbf{Comp} & \textbf{Code} & \textbf{Author(s)} & \textbf{Notes} \\ \hline
ClinVar API Client & Local & 5 & Python & Brandon, Kaira & Entrez API, 200/batch \\ \hline
Variant Preprocessing & Local & 5 & Python & Brandon, Jenny & Extract chr:start-end, seqs \\ \hline
Ref Genome Sampler & Local & 5 & Python & Brandon & Match size dist, ratio=0.7 \\ \hline
Feature Engineering & Local & 5 & Python & Brandon, Jenny & 18 features, no leakage \\ \hline
Random Forest & Local & 5 & Python & Brandon & 200 trees, balanced \\ \hline
Gradient Boosting & Local & 5 & Python & Brandon & 200 est, lr=0.05 \\ \hline
XGBoost & Local & 5 & Python & Brandon & Auto scale\_pos\_weight \\ \hline
Ensemble Voting & Local & 5 & Python & Brandon & Soft vote, thresh=0.6 \\ \hline
Cross-Validation & Local & 5 & Python & Brandon, Jenny & Stratified 10-fold \\ \hline
BAM Deletion Extract & Local & 5 & Python & Brandon & CIGAR parse, MAPQ$\geq$20 \\ \hline
Gene Annotation & Local & 5 & Python & Brandon, Tanvir & GTF overlap, GENCODE v19 \\ \hline
Pathogenicity Pred & Local & 5 & Python & Brandon, Jenny & Main inference, JSON out \\ \hline
Visualization & Local & 5 & Python & Tanvir, Kaira & Conf matrix, ROC, resid \\ \hline
Training Pipeline & Local & 5 & Python & All & End-to-end auto \\ \hline
Inference Pipeline & Local & 5 & Python & Brandon, Tanvir & BAM â†’ predictions \\ \hline
Validation Pipeline & Local & 3 & Python & Brandon & GIAB comparison \\ \hline
Jupyter Demo & Local & 5 & Python & All & Step-by-step tutorial \\ \hline
CLI (main.py) & Local & 5 & Python & Brandon & train/infer/validate \\ \hline
\end{tabular}

\section{External Tools \& Libraries}

\textbf{ML Frameworks:} scikit-learn (v1.7.2): RandomForest, GradientBoosting, train\_test\_split, StratifiedKFold, RobustScaler, LabelEncoder, metrics; XGBoost (v2.1.3); pandas (v2.3.3); numpy (v2.3.4)

\textbf{Genomics:} pysam (v0.23.3): BAM/FASTA parsing, CIGAR analysis; biopython (v1.84): Entrez API

\textbf{Visualization:} matplotlib (v3.10.0), seaborn (v0.13.2)

\textbf{Utilities:} python-dotenv, pathlib, logging

\textbf{Datasets:}
\begin{itemize}
    \item ClinVar (NCBI): 11,218 deletions (chr17); Entrez API access
    \item hs37d5 (1000 Genomes): 3GB FASTA; sequence extraction (we only use a subset of this)
    \item GENCODE v19: 1GB GTF; gene annotations (GRCh37)
\end{itemize}

\textbf{Open-Source Code:} None reused. All original implementation. Followed sklearn/pysam documentation for ClinVar batching, reference sampling, CIGAR parsing, feature engineering, ensemble training.

\textbf{Dependencies:} Python 3.9+, 8GB RAM, 5GB storage

\textbf{License:} Educational use (CMPT 310). Authors retain copyright; SFU has academic sharing permission.
    
\end{document}